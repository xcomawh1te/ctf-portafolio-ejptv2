# Máquina: DC01 - HackMyVM
Dificultad: Easy  
Sistema: Windows 

<img width="1356" height="517" alt="image" src="https://github.com/user-attachments/assets/59d83c52-1f6c-4a1f-9f29-d7c4ed66de3f" />


## 1. Reconocimiento
Partimos con  sudo arp-scan -I eth0 --localnet  y verificamos que nuestra maquina con la MAC que comienza con 08:00 corresponde a una máquina virtual
con IP 192.168.100.21  ( 08:00:27:d5:56:19 )

<img width="649" height="200" alt="image" src="https://github.com/user-attachments/assets/213a69ab-ffb2-4954-b167-ac432a1030f9" />


## 2. Enumeración
Comenzamos con el escaneo de puertos para nuestra ip victima y lo guardamos en un archivo para tener los datos 
</br> sudo nmap -p- -sS -sC -sV --min-rate 5000 -n -vvv -Pn 192.168.100.21 -oN DC01_escaneo

<img width="838" height="540" alt="image" src="https://github.com/user-attachments/assets/3ef85c47-904b-409c-91b7-354074087952" />

<img width="929" height="397" alt="image" src="https://github.com/user-attachments/assets/b14669f5-7111-4719-afb2-87a95f4f2cc8" />

Notamos que hay un servicio de Active Directory Windows TLL 128 , el cual muestra el nombre de Dominio que guardaremos en /etc/host/
para tener como dato. </br>

<img width="298" height="48" alt="image" src="https://github.com/user-attachments/assets/e5f6b505-b020-4b06-9a0a-23acabf34294" /> </br>

<img width="447" height="227" alt="image" src="https://github.com/user-attachments/assets/794b6e72-b82c-4a96-97be-4f6e7efa67c7" /></br>

Para enumerar Puertos podemos probar si existe alguna vulnerabilidad directamente con algún puerto , escogeremos el 445 probando con 
nmap --script+=vuln -p 445 Pn 192.168.100.21 </br>

En esta ocación no existe vulnerabilidad a la fecha </br>
<img width="558" height="159" alt="image" src="https://github.com/user-attachments/assets/810d1f8c-7fb8-4a35-9e1a-3df4aca8911e" />

Tambien podemos recurrir a revisar los permisos del puerto 455  de la siguiente manera</br>
<img width="736" height="238" alt="image" src="https://github.com/user-attachments/assets/ad6ad8e4-5901-4c9b-ae0e-a782c9ce8844" /></br>

<img width="923" height="242" alt="image" src="https://github.com/user-attachments/assets/4ad16b59-cd11-4945-8be7-6a58f5e40766" /></br>

Acá obserbamos que tenemos permisos de Lectura sobre $IPC, también podemos verlo con smbmap -H 192.168.100.21 -u 'guest' -p '' -r IPC$ 
</br>
<img width="709" height="480" alt="image" src="https://github.com/user-attachments/assets/a0ae0707-14ca-4327-8a1c-01b154ae4d52" />
<br>
<img width="846" height="545" alt="image" src="https://github.com/user-attachments/assets/a6926ae4-4006-42f8-bb85-4a95b31257fa" />

ahora intentaremos leer los recursos compartidos de IPC$ mediante netexec smb 192.168.56.128 -u 'guest' -p '' --rid-brute  </br>
y obtener usuarios

<img width="648" height="34" alt="image" src="https://github.com/user-attachments/assets/fb344b24-eb40-4305-9dea-a1446d130620" />
Lo importante aca es guardar los usuarios en un archivo que nombraremos data, de el cual obtendremos usuarios para poder explotar posteriormente 

<br> en nuestro archivo vamos a extraer solo los datos que nos interesan en este caso son los nombres de usuario y para ello usamos el siguiente comando 
cat data | awk '{print $6}' | tr '\\' ' ' | awk '{print $2}' > usuarios_filtrados

<img width="803" height="45" alt="image" src="https://github.com/user-attachments/assets/712131d6-1036-47d9-ac79-ccf7d1f95f63" />
pasamos de esto <br>
<img width="925" height="265" alt="image" src="https://github.com/user-attachments/assets/4b3e0d16-19e5-4875-a86c-293c0041e6f6" />
<br>
a esto <br>
<img width="772" height="270" alt="image" src="https://github.com/user-attachments/assets/c4630c5f-5432-4b02-9429-147814ea1078" /><br>
Hemos rescatado en total <br>
<img width="358" height="59" alt="image" src="https://github.com/user-attachments/assets/4237a85d-22ae-4f7c-9a99-68fc29fc8f16" />
<br>
Con la intención de encontrar un usuario que posea mismo nombre y contraseña corremos el comando <br>
netexec smb 192.168.100.21 -u usuarios_filtrados -p usuarios_filtrados --continue-on-success --no-bruteforce <br>
<img width="1314" height="280" alt="image" src="https://github.com/user-attachments/assets/322124fe-709b-43a6-872e-92c324fab054" /><br>

<img width="738" height="17" alt="image" src="https://github.com/user-attachments/assets/fe8891db-cde4-45bb-b9f7-4bcd50827788" /><br>
luego comprobaremos con netexec las credenciales obtenidas <br>

<img width="1323" height="72" alt="image" src="https://github.com/user-attachments/assets/34d940c6-f1ac-4b3d-8a94-5a44b01eb12c" /><br>

Ahora podremos enumerar Recursos compartidos de manera autenticada y podremos ver uno de Users <br>

<img width="1280" height="221" alt="image" src="https://github.com/user-attachments/assets/d5c4bb04-934e-4121-8529-0ba197960f10" /><br>


<img width="775" height="297" alt="image" src="https://github.com/user-attachments/assets/6df19449-accb-464c-8656-2aaf48762ba2" />
<br>

Comprobaremos si hay usuarios vulnerables a un AS-REP Roasting o kerberoasting usaremos una utilidad de impacket (Se obtiene del sitio HackTricks)<br>
<img width="816" height="303" alt="image" src="https://github.com/user-attachments/assets/4050f923-fb34-4c5a-99d0-f2ba2c9e524d" /> <br>

Acá aparecen posibles usuarios vulnerables a un AS-REP Roasting o Kerberoasting<br>
<img width="1128" height="293" alt="image" src="https://github.com/user-attachments/assets/f7317f5c-7378-48b2-af32-3c519004afea" /> <br>

Aplicamos un ataque Kerberoasting (Se debe sincronizar la hora de la máquina con el DOMAIN Controller para quitar el error de skew clock..)
<br>
<img width="414" height="58" alt="image" src="https://github.com/user-attachments/assets/7b843dd3-d5bd-481e-8142-564b8ef54634" /><br>

Comprobamos nuevamente con impaket y ya se elimina ese error, de paso guardamos el output en un archivo hashes.kerberoast <br>
<img width="1081" height="237" alt="image" src="https://github.com/user-attachments/assets/18554128-faab-4d85-a169-c3fcc58d7176" /><br>

Abrimos nuestro archivo con un cat sobre hashes.kerberoast <br>
<img width="1335" height="329" alt="image" src="https://github.com/user-attachments/assets/5adff4f9-0e97-4f5a-855c-3dd0324dc8ea" /><br>

Realizamos un john usando el diccionario rockyou.txt para verificar si hay algun usuario con contraseña débil<br>
Encontramos una contraseña Pasword123!! <br>
<img width="864" height="179" alt="image" src="https://github.com/user-attachments/assets/b6155bed-384c-4f0d-8879-0dab9323ac94" /><br>

<br>
Como no sabemos a quien pertenece esa contraseña , recordemos que tenemos nuestro archivo de usuarios_filtrados.txt a la cual podemos aplicarle un
netexec smb a la ip de la maquina victima -u (nuestro archivo de usuarios filtrados) -p (Password123!!) --continue-on-success para ver que usuario tiene la contraseñá de Passwod123!! <br>
<img width="1285" height="376" alt="image" src="https://github.com/user-attachments/assets/f19eba93-5f36-4997-8eb2-9c1b019fd111" /> <br>

A lo cual responde que la contraseña encontrada corresponde al usuario file_svc<br>

<img width="953" height="25" alt="image" src="https://github.com/user-attachments/assets/38cccb43-4699-4f75-ad94-9f24e7f9c80d" /><br>
<br>
<br>

Luego comprobamos el acceso con las credenciales mediante netexec smb a la ip de la maquina usando las credenciales obtenidas en -u y -p <br>
<br>
<img width="1298" height="70" alt="image" src="https://github.com/user-attachments/assets/fef44fa5-3d71-4364-bc9b-dbf658137cd8" /><br>
<br>

Hacemos un SMBMAP para entrar y revisar los permisos del usuario, lo cual nos encuentra permisos de Lectura en un archivo Backup<br>

<img width="829" height="487" alt="image" src="https://github.com/user-attachments/assets/0bc806f8-35f8-41de-aa41-f878c1dbdc35" /><br>

Revisaremos el archivo para ver su contenido y encontramos un backup.extract.txt <br>

<img width="826" height="507" alt="image" src="https://github.com/user-attachments/assets/8a08430e-55a3-4b09-b762-a28cdddd9cdf" /><br>
cat

Una vez adentro, realizaremos la descarga con --download para llevarla a un archivo y poder examinar su contenido <br>
Cambiamos su nombre y lo abrimos con cat ya ya tenemos hashes de usuarios <br>

<img width="1269" height="534" alt="image" src="https://github.com/user-attachments/assets/d9de22ac-4b6f-437d-a2a5-870c3a768c0e" /> <br>


## 3. Explotación

Con los hashes intentaremos realizar un Pass The Hash <br>
Para ello extraemos la ultima parte y la primnera para hacer usuarios y hashes
<img width="768" height="417" alt="image" src="https://github.com/user-attachments/assets/a44f4a85-8368-4cac-9d06-86adf1ee66ec" /><br>
Guardamos los hashes en un archivo hashes.txt<br>
<img width="687" height="40" alt="image" src="https://github.com/user-attachments/assets/15786840-3612-40b4-b2cc-ee1992400457" /><br>
Y Guardamos nuestros usuarios como users.txt <br>
<img width="558" height="155" alt="image" src="https://github.com/user-attachments/assets/06f1d455-52ec-4a07-8fdb-b6dc7984322d" /><br>
<img width="486" height="18" alt="image" src="https://github.com/user-attachments/assets/4e9c1b5e-8df0-4e42-9024-d7c06286707d" /> <br>

Ahora si realizamos el Pass The Hash y encontramos un Usuario <br>
<img width="1283" height="229" alt="image" src="https://github.com/user-attachments/assets/bb8eac13-b4b7-46f6-86c0-76c4e4339c2e" /> <br>

Dumpear las credenciales del usuario Admninbistrador si este usuario FIleServer tiene los permisos necesarios <br>
usuario y en la parte de - H se explota el Hash sin proporcionar la contraseña del usuario $FileServer <br>
<img width="1325" height="348" alt="image" src="https://github.com/user-attachments/assets/ce1a57c6-085d-4878-94da-e21e14bca108" /> <br>

<img width="1291" height="104" alt="image" src="https://github.com/user-attachments/assets/665d48f3-d817-4b44-aedf-e26fbe19a83a" /> <br>



## 4. Escalada de privilegios
Ahora realiazmos el Pass The Hash con el usuario Administrator <br>
usamos evil-winrm -i 192.168.100.21 -u Administrator -H aca el hash que nos entrega el usaurio<br>
Luego verificamos con whoami y veremos que ya somos el usuario Administrator
<img width="1211" height="214" alt="image" src="https://github.com/user-attachments/assets/e189ba05-103d-48c3-917f-c5a4f5baf8da" />








## 5. Aprendizajes

